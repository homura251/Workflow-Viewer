# **ComfyUI Workflow Viewer \- 产品需求文档 (PRD)**

| 项目名称 | ComfyUI Workflow Viewer |
| :---- | :---- |
| **版本** | v1.0 |
| **状态** | 规划中 |
| **仓库地址** | [https://github.com/homura251/Workflow-Viewer.git](https://github.com/homura251/Workflow-Viewer.git) |
| **文档日期** | 2026-01-05 |

## **1\. 项目概述 (Overview)**

### **1.1 背景**

ComfyUI 是目前最流行的基于节点的 Stable Diffusion GUI。其工作流文件通常以 .json 格式保存，或嵌入在生成的 .png 图片元数据中。目前，用户若想查看工作流结构，必须启动 ComfyUI 后端服务并加载文件。 本项目旨在开发一个**独立的、轻量级的图形化桌面应用**，允许用户在不运行 Python 后端的情况下，直接打开并查看 ComfyUI 工作流的节点连接、参数设置和逻辑结构。

### **1.2 目标**

* 提供一个跨平台（Windows/macOS/Linux）的桌面可执行文件。  
* 支持拖拽加载 ComfyUI 的 JSON 和 PNG 文件。  
* 完美复刻 ComfyUI 的节点连线视觉效果。  
* 实现自动化构建，代码推送至 GitHub 后自动打包并发布 Release。

## **2\. 用户角色与流程 (User Stories)**

* **作为一名 AI 创作者**，我希望把别人分享的 PNG 图片拖入软件，就能看清它是用什么模型和参数生成的，而不需要等待 ComfyUI 服务器启动。  
* **作为一名工作流开发者**，我希望在整理我的工作流库时，能快速预览文件内容，以便进行分类和重命名。

## **3\. 功能需求 (Functional Requirements)**

### **3.1 核心功能 (Core Features)**

| ID | 功能模块 | 优先级 | 详细描述 |
| :---- | :---- | :---- | :---- |
| **F-01** | **文件导入** | **P0** | 支持拖拽 (Drag & Drop) .json 和 .png (含元数据) 文件进入窗口打开。支持通过菜单栏 "File \-\> Open" 打开。 |
| **F-02** | **格式解析** | **P0** | 1\. 解析标准 ComfyUI JSON 结构。 2\. 提取 PNG 图片中的 tEXt 或 iTXt 块读取 workflow 数据。 |
| **F-03** | **图形渲染** | **P0** | 1\. 绘制节点 (Nodes)：显示标题、输入点、输出点、参数组件。 2\. 绘制连线 (Links)：根据 link\_id 正确连接节点，颜色需区分数据类型（如 MODEL, VAE, IMAGE 等）。 |
| **F-04** | **视图交互** | **P0** | 1\. 画布无限平移 (Panning) \- 鼠标中键或按住空格拖拽。 2\. 缩放 (Zooming) \- 鼠标滚轮缩放视图。 |
| **F-05** | **节点详情** | **P1** | 即使没有后端自定义节点代码，也应以通用 UI 显示节点内的参数值（如 seed, steps, cfg 等）。 |
| **F-06** | **多标签页** | **P2** | 允许同时打开多个工作流文件进行对比（Tab页形式）。 |

### **3.2 界面需求 (UI/UX)**

* **风格**：保持与原生 ComfyUI 相似的暗色主题 (Dark Mode)，降低用户的学习成本。  
* **布局**：  
  * 顶部：菜单栏（文件、视图、帮助）。  
  * 中央：主要画布区域。  
  * （可选）右侧：属性面板，显示选中节点的详细 JSON 数据。

## **4\. 技术架构建议 (Technical Architecture)**

鉴于 ComfyUI 前端本身是基于 Web 技术 (JS/HTML5 Canvas) 构建的，为了最大程度复用逻辑并保证渲染一致性，建议使用 **Electron** 框架。

### **4.1 技术栈推荐**

* **核心框架**: [Electron](https://www.electronjs.org/) (跨平台桌面容器)  
* **前端框架**: React 或 Vue 3  
* **图形库**:  
  * *方案 A (推荐)*: [React Flow](https://reactflow.dev/) 或 [LiteGraph.js](https://www.google.com/search?q=https://github.com/jagenjo/litegraph.js) (ComfyUI 原生使用的库，兼容性最好)。  
* **打包工具**: Electron Builder 或 Electron Forge。  
* **语言**: TypeScript (推荐，利于维护类型定义)。

### **4.2 数据流逻辑**

1. **Main Process (Electron)**: 监听文件拖入事件 \-\> 读取文件二进制流 \-\> (若是PNG) 提取 Metadata \-\> 发送 JSON 到渲染进程。  
2. **Renderer Process (UI)**: 接收 JSON \-\> 实例化 Graph 对象 \-\> 遍历 Nodes 和 Links \-\> 渲染 Canvas。

## **5\. 非功能性需求 (Non-functional Requirements)**

* **性能**: 打开 500+ 节点的大型工作流时，界面不应卡顿。  
* **兼容性**:  
  * Windows 10/11 (主要目标群体)。  
  * macOS (Intel/Apple Silicon)。  
* **容错性**: 遇到无法识别的自定义节点（Custom Nodes），应用不应崩溃，而是显示为“未知节点”或通用红色节点块，并保留原始连线。

## **6\. 构建与发布流程 (CI/CD & Release)**

为了实现“推送到 GitHub 即发布”，我们需要配置 **GitHub Actions**。

### **6.1 版本控制策略**

* main 分支：主开发分支。  
* tag (v\*.*.*)：触发正式 Release 构建。

### **6.2 GitHub Actions 工作流设计**

需要创建一个 .github/workflows/build.yml 文件。

触发条件:  
on: push: tags: \- 'v\*'  
**构建步骤 (Job Steps)**:

1. **Checkout 代码**。  
2. **Setup Node.js**: 安装 Node 环境。  
3. **Install Dependencies**: npm install。  
4. **Build**: 编译 React/Vue 前端代码。  
5. **Package**: 使用 electron-builder 打包。  
   * Windows: 生成 .exe (nsis installer) 和 portable 绿色版。  
   * macOS: 生成 .dmg。  
   * Linux: 生成 .AppImage 或 .deb。  
6. **Create Release**: 调用 softprops/action-gh-release，自动创建 GitHub Release 页，并将上述生成的可执行文件上传为附件。

## **7\. 开发里程碑 (Roadmap)**

### **Phase 1: MVP (最小可行性产品)**

* \[ \] 搭建 Electron \+ LiteGraph.js 基础骨架。  
* \[ \] 实现 .json 文件的读取和渲染。  
* \[ \] 实现基础的缩放和平移。  
* \[ \] 配置 GitHub Actions 实现 Windows .exe 自动打包。

### **Phase 2: 完善体验**

* \[ \] 支持 .png 图片元数据解析。  
* \[ \] 处理“丢失的自定义节点”渲染逻辑（防止白屏）。  
* \[ \] 添加 UI 美化（暗色主题）。

### **Phase 3: 高级功能**

* \[ \] 搜索节点功能。  
* \[ \] 导出功能（将工作流导出为 SVG 或 图片）。  
* \[ \] 自动更新检查。

## **8\. 附录：PNG 元数据解析参考**

ComfyUI 将工作流信息存储在 PNG 的 tEXt 块中，关键字通常为 prompt (执行流) 和 workflow (UI 布局流)。

* **Viewer 主要需要读取 workflow 字段**，因为它包含了节点在画布上的坐标 (position) 和尺寸，而 prompt 仅包含执行逻辑，没有坐标信息。